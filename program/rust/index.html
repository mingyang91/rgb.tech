<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>RGB smart contracts</title>
  <link rel="stylesheet" href="/tachyons-ext.css">
  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="/front.css">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta http-equiv="pragma" content="no-cache">
  
    <meta name="description" content="">

    <meta property="og:title" content="RGB in Rust" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://rgb.tech/rgb-banner.png" />
    <meta name="twitter:card" content="summary_large_image">

    <meta property="og:description" content="">
    <meta property="og:site_name" content="RGB protocol">

    <meta name="twitter:site" content="@lnp_bp">

</head>

<body>
<nav class="flex flex-row justify-center justify-end-l items-center flex-wrap ph2 pl3-ns pr3-ns pb3">
  <div id="logo" class="flex-auto w-100 w-auto-l self-start self-center tc tl-l">
    <a href="/">
      <img alt="RGB Logo" src="/logo/rgb-symbol-color.svg">
    </a>
  </div>
  <ul class="nav list w-100 w-auto-l flex flex-none flex-row flex-wrap justify-center justify-end-l items-center pv2 ph0 ph4-ns">
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/install">Install</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/learn">Learn</a></li>
    <!-- li class="tc pv2 ph2 ph4-ns flex-20-s">Tools</li -->
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/governance">Governance</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://t.me/rgbtelegram">Community</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/blog">Blog</a></li>
  </ul>
</nav>
<main>
  
    
    
        
    
    <section class="section-white li-columns">
        <div>
            <header class="pb0">
                <h1 id="title">RGB in Rust</h1>
            </header>

            <p><strong>NB: Work in progress – the chapter is not fully written yet and lack
explanation details for the code. <br/>Please contribute at
<a href="https://github.com/RGB-WG/rgb.tech">our GitHub</a>.</strong></p>
<p>We will start with showing how a simple RGB20 contract can be written in Rust
using pre-existing schema and no advanced functionality. The rest of the
chapter will guide you through adding more and more customization to it, which
will require creating a custom state data types, writing validation scripts
for them, packing them into a new schema – and providing a custom interface
to this schema.</p>
<ul>
<li><a href="#basics" class="button button-secondary">Writing simple contract</a></li>
<li><a href="#state" class="button button-secondary">Creating custom state</a></li>
<li><a href="#scripts" class="button button-secondary">Scripting validation</a></li>
</ul>
<ul>
<li><a href="#schema" class="button button-secondary">Creating custom schema</a></li>
<li><a href="#interface" class="button button-secondary">Doing custom interface</a></li>
<li><a href="#iimpl" class="button button-secondary">Implementing interface</a></li>
</ul>
<p>Sample project providing the source code from this chapter can be found in
<a href="https://github.com/RGB-WG/rgb-schemata/blob/master/examples/rgb20.rs">examples directory of RGB smart contract compiler repository</a>.</p>

        </div>
    </section>
        
            
        
        
            
            
        
        <section class="section-white ">
            <div>
                <header  id="basics"  class="pb0">
                    <h2>Writing simple contract</h2>
                    <div class="highlight"></div>
                </header>

                <p>Firstly, using cargo to create a new project: <code>cargo new rgb20-token</code>, and enter
it: <code>cd rgb20-token</code>. Then create a directory to store the contract file. You may
name it whatever you like, here we set it to <code>examples</code>: <code>mkdir examples</code>.
See source codes at <a href="https://github.com/bitlightlabs/bitlight-rgb20-contract">RGB20 Contract</a>.</p>
<p>Here is the complete project file tree:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>➜  rgb20-token git:(main) ✗ tree .
</span><span>.
</span><span>├── Cargo.lock
</span><span>├── Cargo.toml
</span><span>├── contracts
</span><span>└── src
</span><span>    └── main.rs
</span><span>
</span><span>3 directories, 3 files
</span></code></pre>
<p>Secondly, we add some libs in <code>Cargo.toml</code> file:</p>
<pre data-lang="toml" style="background-color:#2b303b;color:#c0c5ce;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[package]
</span><span style="color:#bf616a;">name </span><span>= &quot;</span><span style="color:#a3be8c;">rgb20-token</span><span>&quot;
</span><span style="color:#bf616a;">version </span><span>= &quot;</span><span style="color:#a3be8c;">0.1.0</span><span>&quot;
</span><span style="color:#bf616a;">edition </span><span>= &quot;</span><span style="color:#a3be8c;">2021</span><span>&quot;
</span><span style="color:#bf616a;">resolver </span><span>= &quot;</span><span style="color:#a3be8c;">2</span><span>&quot;
</span><span>
</span><span>[dependencies]
</span><span style="color:#bf616a;">amplify </span><span>= &quot;</span><span style="color:#a3be8c;">4.6.0</span><span>&quot;
</span><span style="color:#bf616a;">ascii-armor </span><span>= &quot;</span><span style="color:#a3be8c;">0.2.0</span><span>&quot;
</span><span style="color:#bf616a;">strict_encoding </span><span>= &quot;</span><span style="color:#a3be8c;">2.7.0-beta.1</span><span>&quot;
</span><span style="color:#bf616a;">strict_types </span><span>= &quot;</span><span style="color:#a3be8c;">2.7.0-beta.1</span><span>&quot;
</span><span style="color:#bf616a;">aluvm </span><span>= { </span><span style="color:#bf616a;">version </span><span>= &quot;</span><span style="color:#a3be8c;">0.11.0-beta.4</span><span>&quot;, </span><span style="color:#bf616a;">features </span><span>= [&quot;</span><span style="color:#a3be8c;">log</span><span>&quot;] }
</span><span style="color:#bf616a;">bp-core </span><span>= &quot;</span><span style="color:#a3be8c;">0.11.0-beta.4</span><span>&quot;
</span><span style="color:#bf616a;">rgb-std </span><span>= { </span><span style="color:#bf616a;">version </span><span>= &quot;</span><span style="color:#a3be8c;">0.11.0-beta.4</span><span>&quot;, </span><span style="color:#bf616a;">features </span><span>= [&quot;</span><span style="color:#a3be8c;">serde</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">fs</span><span>&quot;] }
</span><span style="color:#bf616a;">serde </span><span>= &quot;</span><span style="color:#a3be8c;">1.0</span><span>&quot;
</span><span style="color:#bf616a;">serde_json </span><span>= &quot;</span><span style="color:#a3be8c;">1.0</span><span>&quot;
</span><span style="color:#bf616a;">sha2 </span><span>= &quot;</span><span style="color:#a3be8c;">0.10.8</span><span>&quot;
</span><span style="color:#bf616a;">rgb-schemata </span><span>= &quot;</span><span style="color:#a3be8c;">0.11.0-beta.4</span><span>&quot;
</span><span style="color:#bf616a;">hex </span><span>= &quot;</span><span style="color:#a3be8c;">0.4.3</span><span>&quot;
</span><span>
</span><span>[dev-dependencies]
</span><span style="color:#bf616a;">chrono </span><span>= &quot;</span><span style="color:#a3be8c;">0.4.31</span><span>&quot;
</span><span style="color:#bf616a;">serde_yaml </span><span>= &quot;</span><span style="color:#a3be8c;">0.9.27</span><span>&quot;
</span><span>
</span><span>[features]
</span><span style="color:#bf616a;">all </span><span>= []
</span><span>
</span><span>[patch.crates-io]
</span><span style="color:#bf616a;">commit_verify </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/LNP-BP/client_side_validation</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">bp-consensus </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/BP-WG/bp-core</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">bp-dbc </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/BP-WG/bp-core</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">bp-seals </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/BP-WG/bp-core</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">bp-core </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/BP-WG/bp-core</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">rgb-core </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/RGB-WG/rgb-core</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">rgb-std </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/RGB-WG/rgb-std</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span><span style="color:#bf616a;">rgb-schemata </span><span>= { </span><span style="color:#bf616a;">git </span><span>= &quot;</span><span style="color:#a3be8c;">https://github.com/RGB-WG/rgb-schemata</span><span>&quot;, </span><span style="color:#bf616a;">branch </span><span>= &quot;</span><span style="color:#a3be8c;">master</span><span>&quot; }
</span></code></pre>
<p>Then, in <code>src/main.rs</code>, write following codes:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">use </span><span>std::convert::Infallible;
</span><span style="color:#b48ead;">use </span><span>std::fs;
</span><span>
</span><span style="color:#b48ead;">use </span><span>amplify::hex::FromHex;
</span><span style="color:#b48ead;">use </span><span>armor::AsciiArmor;
</span><span style="color:#b48ead;">use </span><span>bp::dbc::Method;
</span><span style="color:#b48ead;">use </span><span>bp::{Outpoint, Txid};
</span><span style="color:#b48ead;">use </span><span>rgb_schemata::NonInflatableAsset;
</span><span style="color:#b48ead;">use </span><span>rgbstd::containers::FileContent;
</span><span style="color:#b48ead;">use </span><span>rgbstd::interface::{FilterIncludeAll, FungibleAllocation, IfaceClass, IssuerClass, Rgb20};
</span><span style="color:#b48ead;">use </span><span>rgbstd::invoice::Precision;
</span><span style="color:#b48ead;">use </span><span>rgbstd::persistence::{Inventory, Stock};
</span><span style="color:#b48ead;">use </span><span>rgbstd::resolvers::ResolveHeight;
</span><span style="color:#b48ead;">use </span><span>rgbstd::validation::{ResolveWitness, WitnessResolverError};
</span><span style="color:#b48ead;">use </span><span>rgbstd::{WitnessAnchor, WitnessId, XAnchor, XPubWitness};
</span><span style="color:#b48ead;">use </span><span>strict_encoding::StrictDumb;
</span><span>
</span><span style="color:#b48ead;">struct </span><span>DumbResolver;
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ResolveWitness </span><span style="color:#b48ead;">for </span><span>DumbResolver {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">resolve_pub_witness</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, _: WitnessId) -&gt; Result&lt;XPubWitness, WitnessResolverError&gt; {
</span><span>        Ok(XPubWitness::strict_dumb())
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ResolveHeight </span><span style="color:#b48ead;">for </span><span>DumbResolver {
</span><span>    </span><span style="color:#b48ead;">type </span><span>Error = Infallible;
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">resolve_anchor</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>, _: &amp;XAnchor) -&gt; Result&lt;WitnessAnchor, </span><span style="color:#b48ead;">Self::</span><span>Error&gt; {
</span><span>        Ok(WitnessAnchor::strict_dumb())
</span><span>    }
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">rustfmt</span><span>::</span><span style="color:#bf616a;">skip</span><span>]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> beneficiary_txid =
</span><span>        Txid::from_hex(&quot;</span><span style="color:#a3be8c;">d6afd1233f2c3a7228ae2f07d64b2091db0d66f2e8ef169cf01217617f51b8fb</span><span>&quot;).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    </span><span style="color:#b48ead;">let</span><span> beneficiary = Outpoint::new(beneficiary_txid, </span><span style="color:#d08770;">1</span><span>);
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> contract = NonInflatableAsset::testnet(&quot;</span><span style="color:#a3be8c;">TEST</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">Test asset</span><span>&quot;, None, Precision::CentiMicro)
</span><span>        .</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">invalid contract data</span><span>&quot;)
</span><span>        .</span><span style="color:#96b5b4;">allocate</span><span>(Method::TapretFirst, beneficiary, </span><span style="color:#d08770;">100_000_000_000_</span><span style="color:#b48ead;">u64</span><span>.</span><span style="color:#96b5b4;">into</span><span>())
</span><span>        .</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">invalid allocations</span><span>&quot;)
</span><span>        .</span><span style="color:#96b5b4;">issue_contract</span><span>()
</span><span>        .</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">invalid contract data</span><span>&quot;);
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> contract_id = contract.</span><span style="color:#96b5b4;">contract_id</span><span>();
</span><span>
</span><span>    eprintln!(&quot;</span><span style="color:#d08770;">{contract}</span><span>&quot;);
</span><span>    contract.</span><span style="color:#96b5b4;">save_file</span><span>(&quot;</span><span style="color:#a3be8c;">examples/rgb20-simplest.rgb</span><span>&quot;).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">unable to save contract</span><span>&quot;);
</span><span>    fs::write(&quot;</span><span style="color:#a3be8c;">examples/rgb20-simplest.rgba</span><span>&quot;, contract.</span><span style="color:#96b5b4;">to_ascii_armored_string</span><span>()).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">unable to save contract</span><span>&quot;);
</span><span>
</span><span>    </span><span style="color:#65737e;">// Let&#39;s create some stock - an in-memory stash and inventory around it:
</span><span>    </span><span style="color:#b48ead;">let mut</span><span> stock = Stock::default();
</span><span>    stock.</span><span style="color:#96b5b4;">import_iface</span><span>(Rgb20::iface()).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    stock.</span><span style="color:#96b5b4;">import_schema</span><span>(NonInflatableAsset::schema()).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    stock.</span><span style="color:#96b5b4;">import_iface_impl</span><span>(NonInflatableAsset::issue_impl()).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>
</span><span>    stock.</span><span style="color:#96b5b4;">import_contract</span><span>(contract, &amp;</span><span style="color:#b48ead;">mut</span><span> DumbResolver).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>
</span><span>    </span><span style="color:#65737e;">// Reading contract state through the interface from the stock:
</span><span>    </span><span style="color:#b48ead;">let</span><span> contract = stock.</span><span style="color:#96b5b4;">contract_iface_id</span><span>(contract_id, Rgb20::iface().</span><span style="color:#96b5b4;">iface_id</span><span>()).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    </span><span style="color:#b48ead;">let</span><span> contract = Rgb20::from(contract);
</span><span>    </span><span style="color:#b48ead;">let</span><span> allocations = contract.</span><span style="color:#96b5b4;">fungible</span><span>(&quot;</span><span style="color:#a3be8c;">assetOwner</span><span>&quot;, &amp;FilterIncludeAll).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    eprintln!(&quot;</span><span style="color:#96b5b4;">\n</span><span style="color:#a3be8c;">The issued contract data:</span><span>&quot;);
</span><span>    eprintln!(&quot;</span><span style="color:#d08770;">{}</span><span>&quot;, serde_json::to_string(&amp;contract.</span><span style="color:#96b5b4;">spec</span><span>()).</span><span style="color:#96b5b4;">unwrap</span><span>());
</span><span>
</span><span>    </span><span style="color:#b48ead;">for</span><span> FungibleAllocation  { seal, state, witness, .. } in allocations {
</span><span>        eprintln!(&quot;</span><span style="color:#a3be8c;">amount=</span><span style="color:#d08770;">{state}</span><span style="color:#a3be8c;">, owner=</span><span style="color:#d08770;">{seal}</span><span style="color:#a3be8c;">, witness=</span><span style="color:#d08770;">{witness}</span><span>&quot;);
</span><span>    }
</span><span>    eprintln!(&quot;</span><span style="color:#a3be8c;">totalSupply=</span><span style="color:#d08770;">{}</span><span>&quot;, contract.</span><span style="color:#96b5b4;">total_supply</span><span>());
</span><span>    eprintln!(&quot;</span><span style="color:#a3be8c;">created=</span><span style="color:#d08770;">{}</span><span>&quot;, contract.</span><span style="color:#96b5b4;">created</span><span>().</span><span style="color:#96b5b4;">to_local</span><span>().</span><span style="color:#96b5b4;">unwrap</span><span>());
</span><span>}
</span><span>
</span><span>
</span></code></pre>
<p>Save it, and execute <code>cargo run</code>, after that, contract file would save in
<code>examples</code> directory. You can specify your own token name, decimal,
description, beneficiary and supply by modifing corresponding variable's value,
as well as contracts saving fold.</p>
<p>Now, you can import the contract with <code>rgb import</code> command:
<code>rgb import examples/rgb20-simplest.rgb</code>.</p>

            </div>
        </section>
    
        
            
        
        
            
            
        
        <section class="section-red ">
            <div>
                <header  id="state"  class="pb0">
                    <h2>Creating custom state</h2>
                    <div class="highlight"></div>
                </header>

                <p>Custom state can be added to a contract by defining a data type which will hold 
it. Data type is a rust structure or enum, which implements <code>strict_encoding</code>
traits. The simplest way to add this implementation is through derive macros:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">derive</span><span>(Clone, Eq, PartialEq, Debug)]
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(StrictDumb, StrictType, StrictEncode, StrictDecode)]
</span><span>#[</span><span style="color:#bf616a;">strict_type</span><span>(lib = LIB_NAME_RGB_CONTRACT)]
</span><span>#[</span><span style="color:#bf616a;">cfg_attr</span><span>(
</span><span>    feature = &quot;</span><span style="color:#a3be8c;">serde</span><span>&quot;,
</span><span>    </span><span style="color:#bf616a;">derive</span><span>(Serialize, Deserialize),
</span><span>    </span><span style="color:#bf616a;">serde</span><span>(crate = &quot;</span><span style="color:#a3be8c;">serde_crate</span><span>&quot;, rename_all = &quot;</span><span style="color:#a3be8c;">camelCase</span><span>&quot;)
</span><span>)]
</span><span style="color:#b48ead;">pub struct </span><span>Nominal {
</span><span>    </span><span style="color:#bf616a;">ticker</span><span>: Ticker,
</span><span>    </span><span style="color:#bf616a;">name</span><span>: ContractName,
</span><span>    </span><span style="color:#bf616a;">details</span><span>: Option&lt;ContractDetails&gt;,
</span><span>    </span><span style="color:#bf616a;">precision</span><span>: Precision,
</span><span>}
</span><span style="color:#b48ead;">impl </span><span>StrictSerialize </span><span style="color:#b48ead;">for </span><span>Nominal {}
</span><span style="color:#b48ead;">impl </span><span>StrictDeserialize </span><span style="color:#b48ead;">for </span><span>Nominal {}
</span></code></pre>
<p>Once declared, the type can be compiled into a type library:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> lib = LibBuilder::new(libname!(</span><span style="color:#d08770;">LIB_NAME_RGB_CONTRACT</span><span>))
</span><span>    .process::&lt;Nominal&gt;()?
</span><span>    .</span><span style="color:#96b5b4;">compile</span><span>(none!())?;
</span><span style="color:#b48ead;">let</span><span> types = SystemBuilder::new()
</span><span>    .</span><span style="color:#96b5b4;">import</span><span>(lib)?
</span><span>    .</span><span style="color:#96b5b4;">finalize</span><span>()?;
</span></code></pre>

            </div>
        </section>
    
        
            
        
        
            
            
        
        <section class="section-green ">
            <div>
                <header  id="scripts"  class="pb0">
                    <h2>Scripting</h2>
                    <div class="highlight"></div>
                </header>

                <pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    </span><span style="color:#b48ead;">let</span><span> code = [RgbIsa::Contract(ContractOp::PcVs(</span><span style="color:#d08770;">OS_ASSETS</span><span>))];
</span><span>    </span><span style="color:#b48ead;">let</span><span> alu_lib = Lib::assemble(&amp;code).</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>    </span><span style="color:#b48ead;">let</span><span> alu_id = alu_lib.</span><span style="color:#96b5b4;">id</span><span>();
</span></code></pre>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>    </span><span style="color:#b48ead;">let</span><span> code = aluasm! {
</span><span>        clr     r1024[</span><span style="color:#d08770;">5</span><span>]                        ;
</span><span>        put     </span><span style="color:#d08770;">5</span><span>,a16[</span><span style="color:#d08770;">8</span><span>]                        ;
</span><span>        putif   </span><span style="color:#d08770;">0xaf67937b5498dc</span><span>,r256[</span><span style="color:#d08770;">1</span><span>]        ;
</span><span>        putif   </span><span style="color:#d08770;">13</span><span>,a8[</span><span style="color:#d08770;">1</span><span>]                        ;
</span><span>        swp     a8[</span><span style="color:#d08770;">1</span><span>],a8[</span><span style="color:#d08770;">2</span><span>]                     ;
</span><span>        swp     f256[</span><span style="color:#d08770;">8</span><span>],f256[</span><span style="color:#d08770;">7</span><span>]                 ;
</span><span>        dup     a256[</span><span style="color:#d08770;">1</span><span>],a256[</span><span style="color:#d08770;">7</span><span>]                 ;
</span><span>        mov     a16[</span><span style="color:#d08770;">1</span><span>],a16[</span><span style="color:#d08770;">2</span><span>]                   ;
</span><span>        mov     r256[</span><span style="color:#d08770;">8</span><span>],r256[</span><span style="color:#d08770;">7</span><span>]                 ;
</span><span>        cpy     a256[</span><span style="color:#d08770;">1</span><span>],a256[</span><span style="color:#d08770;">7</span><span>]                 ;
</span><span>        cnv     f128[</span><span style="color:#d08770;">4</span><span>],a128[</span><span style="color:#d08770;">3</span><span>]                 ;
</span><span>        spy     a1024[</span><span style="color:#d08770;">15</span><span>],r1024[</span><span style="color:#d08770;">24</span><span>]             ;
</span><span>        gt.u    a8[</span><span style="color:#d08770;">5</span><span>],a64[</span><span style="color:#d08770;">9</span><span>]                    ;
</span><span>        lt.s    a8[</span><span style="color:#d08770;">5</span><span>],a64[</span><span style="color:#d08770;">9</span><span>]                    ;
</span><span>        gt.e    </span><span style="color:#b48ead;">f64</span><span>[</span><span style="color:#d08770;">5</span><span>],</span><span style="color:#b48ead;">f64</span><span>[</span><span style="color:#d08770;">9</span><span>]                   ;
</span><span>        lt.r    </span><span style="color:#b48ead;">f64</span><span>[</span><span style="color:#d08770;">5</span><span>],</span><span style="color:#b48ead;">f64</span><span>[</span><span style="color:#d08770;">9</span><span>]                   ;
</span><span>        gt      r160[</span><span style="color:#d08770;">5</span><span>],r256[</span><span style="color:#d08770;">9</span><span>]                 ;
</span><span>        lt      r160[</span><span style="color:#d08770;">5</span><span>],r256[</span><span style="color:#d08770;">9</span><span>]                 ;
</span><span>        eq.e    a8[</span><span style="color:#d08770;">5</span><span>],a8[</span><span style="color:#d08770;">9</span><span>]                    ;
</span><span>        eq.n    r160[</span><span style="color:#d08770;">5</span><span>],r160[</span><span style="color:#d08770;">9</span><span>]                 ;
</span><span>        eq.e    </span><span style="color:#b48ead;">f64</span><span>[</span><span style="color:#d08770;">19</span><span>],</span><span style="color:#b48ead;">f64</span><span>[</span><span style="color:#d08770;">29</span><span>]                 ;
</span><span>        ifn     a32[</span><span style="color:#d08770;">32</span><span>]                         ;
</span><span>        ifz     r2048[</span><span style="color:#d08770;">17</span><span>]                       ;
</span><span>        inv     st0                             ;
</span><span>        st.s    a8[</span><span style="color:#d08770;">1</span><span>]                           ;
</span><span>        put     </span><span style="color:#d08770;">13</span><span>,a32[</span><span style="color:#d08770;">12</span><span>]                      ;
</span><span>        put     </span><span style="color:#d08770;">66</span><span>,a32[</span><span style="color:#d08770;">13</span><span>]                      ;
</span><span>        add.uc  a32[</span><span style="color:#d08770;">12</span><span>],a32[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        add.sw  a32[</span><span style="color:#d08770;">12</span><span>],a32[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        sub.sc  a32[</span><span style="color:#d08770;">13</span><span>],a32[</span><span style="color:#d08770;">12</span><span>]                 ;
</span><span>        mul.uw  a32[</span><span style="color:#d08770;">12</span><span>],a32[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        div.cu  a32[</span><span style="color:#d08770;">12</span><span>],a32[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        put     </span><span style="color:#d08770;">2.13</span><span>,</span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">12</span><span>]                    ;
</span><span>        put     </span><span style="color:#d08770;">5.18</span><span>,</span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">13</span><span>]                    ;
</span><span>        add.z   </span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">12</span><span>],</span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        sub.n   </span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">13</span><span>],</span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">12</span><span>]                 ;
</span><span>        mul.c   </span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">12</span><span>],</span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        div.f   </span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">12</span><span>],</span><span style="color:#b48ead;">f32</span><span>[</span><span style="color:#d08770;">13</span><span>]                 ;
</span><span>        rem     a64[</span><span style="color:#d08770;">8</span><span>],a8[</span><span style="color:#d08770;">2</span><span>]                    ;
</span><span>        inc     a16[</span><span style="color:#d08770;">3</span><span>]                          ;
</span><span>        add     </span><span style="color:#d08770;">5</span><span>,a16[</span><span style="color:#d08770;">4</span><span>]                        ;
</span><span>        dec     a16[</span><span style="color:#d08770;">8</span><span>]                          ;
</span><span>        sub     </span><span style="color:#d08770;">82</span><span>,a16[</span><span style="color:#d08770;">4</span><span>]                       ;
</span><span>        neg     a64[</span><span style="color:#d08770;">16</span><span>]                         ;
</span><span>        abs     f128[</span><span style="color:#d08770;">11</span><span>]                        ;
</span><span>        and     a32[</span><span style="color:#d08770;">5</span><span>],a32[</span><span style="color:#d08770;">6</span><span>],a32[</span><span style="color:#d08770;">5</span><span>]            ;
</span><span>        xor     r128[</span><span style="color:#d08770;">5</span><span>],r128[</span><span style="color:#d08770;">6</span><span>],r128[</span><span style="color:#d08770;">5</span><span>]         ;
</span><span>        shr.u   a256[</span><span style="color:#d08770;">12</span><span>],a16[</span><span style="color:#d08770;">2</span><span>]                 ;
</span><span>        shr.s   a256[</span><span style="color:#d08770;">12</span><span>],a16[</span><span style="color:#d08770;">2</span><span>]                 ;
</span><span>        shl     r256[</span><span style="color:#d08770;">24</span><span>],a16[</span><span style="color:#d08770;">22</span><span>]                ;
</span><span>        shr     r256[</span><span style="color:#d08770;">24</span><span>],a16[</span><span style="color:#d08770;">22</span><span>]                ;
</span><span>        scr     r256[</span><span style="color:#d08770;">24</span><span>],a16[</span><span style="color:#d08770;">22</span><span>]                ;
</span><span>        scl     r256[</span><span style="color:#d08770;">24</span><span>],a16[</span><span style="color:#d08770;">22</span><span>]                ;
</span><span>        rev     a512[</span><span style="color:#d08770;">28</span><span>]                        ;
</span><span>        ripemd  s16[</span><span style="color:#d08770;">9</span><span>],r160[</span><span style="color:#d08770;">7</span><span>]                  ;
</span><span>        sha2    s16[</span><span style="color:#d08770;">19</span><span>],r256[</span><span style="color:#d08770;">2</span><span>]                 ;
</span><span>        secpgen r256[</span><span style="color:#d08770;">1</span><span>],r512[</span><span style="color:#d08770;">1</span><span>]                 ;
</span><span>        dup     r512[</span><span style="color:#d08770;">1</span><span>],r512[</span><span style="color:#d08770;">22</span><span>]                ;
</span><span>        spy     a512[</span><span style="color:#d08770;">1</span><span>],r512[</span><span style="color:#d08770;">22</span><span>]                ;
</span><span>        secpmul r256[</span><span style="color:#d08770;">1</span><span>],r512[</span><span style="color:#d08770;">1</span><span>],r512[</span><span style="color:#d08770;">2</span><span>]         ;
</span><span>        secpadd r512[</span><span style="color:#d08770;">22</span><span>],r512[</span><span style="color:#d08770;">1</span><span>]                ;
</span><span>        secpneg r512[</span><span style="color:#d08770;">1</span><span>],r512[</span><span style="color:#d08770;">3</span><span>]                 ;
</span><span>        ifz     a16[</span><span style="color:#d08770;">8</span><span>]                          ;
</span><span>        jif     </span><span style="color:#d08770;">190                             </span><span>;
</span><span>        jmp     </span><span style="color:#d08770;">6                               </span><span>;
</span><span>        call    </span><span style="color:#d08770;">56 </span><span>@ alu1wnhusevxmdphv3dh8ada44k0xw66ahq9nzhkv39z07hmudhp380sq0dtml ;
</span><span>        ret                                     ;
</span><span>    };
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> lib = Lib::assemble(&amp;code).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">invalid program);
</span></code></pre>

            </div>
        </section>
    
        
            
        
        
            
            
        
        <section class="section-purple ">
            <div>
                <header  id="schema"  class="pb0">
                    <h2>Creating custom schema</h2>
                    <div class="highlight"></div>
                </header>

                <pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">schema</span><span>() -&gt; SubSchema {
</span><span>    Schema {
</span><span>        ffv: zero!(),
</span><span>        subset_of: None,
</span><span>        type_system: types.</span><span style="color:#96b5b4;">type_system</span><span>(),
</span><span>        global_types: tiny_bmap! {
</span><span>            </span><span style="color:#d08770;">GS_NOMINAL </span><span>=&gt; GlobalStateSchema::once(types.</span><span style="color:#96b5b4;">get</span><span>(&quot;</span><span style="color:#a3be8c;">RGBContract.Nominal</span><span>&quot;)),
</span><span>            </span><span style="color:#d08770;">GS_CONTRACT </span><span>=&gt; GlobalStateSchema::once(types.</span><span style="color:#96b5b4;">get</span><span>(&quot;</span><span style="color:#a3be8c;">RGBContract.ContractText</span><span>&quot;)),
</span><span>        },
</span><span>        owned_types: tiny_bmap! {
</span><span>            </span><span style="color:#d08770;">OS_ASSETS </span><span>=&gt; StateSchema::Fungible(FungibleType::Unsigned64Bit),
</span><span>        },
</span><span>        valency_types: none!(),
</span><span>        genesis: GenesisSchema {
</span><span>            metadata: Ty::&lt;SemId&gt;::</span><span style="color:#d08770;">UNIT</span><span>.</span><span style="color:#96b5b4;">id</span><span>(None),
</span><span>            globals: tiny_bmap! {
</span><span>                </span><span style="color:#d08770;">GS_NOMINAL </span><span>=&gt; Occurrences::Once,
</span><span>                </span><span style="color:#d08770;">GS_CONTRACT </span><span>=&gt; Occurrences::Once,
</span><span>            },
</span><span>            assignments: tiny_bmap! {
</span><span>                </span><span style="color:#d08770;">OS_ASSETS </span><span>=&gt; Occurrences::OnceOrMore,
</span><span>            },
</span><span>            valencies: none!(),
</span><span>        },
</span><span>        extensions: none!(),
</span><span>        transitions: tiny_bmap! {
</span><span>            </span><span style="color:#d08770;">TS_TRANSFER </span><span>=&gt; TransitionSchema {
</span><span>                metadata: Ty::&lt;SemId&gt;::</span><span style="color:#d08770;">UNIT</span><span>.</span><span style="color:#96b5b4;">id</span><span>(None),
</span><span>                globals: none!(),
</span><span>                inputs: tiny_bmap! {
</span><span>                    </span><span style="color:#d08770;">OS_ASSETS </span><span>=&gt; Occurrences::OnceOrMore
</span><span>                },
</span><span>                assignments: tiny_bmap! {
</span><span>                    </span><span style="color:#d08770;">OS_ASSETS </span><span>=&gt; Occurrences::OnceOrMore
</span><span>                },
</span><span>                valencies: none!(),
</span><span>            }
</span><span>        },
</span><span>        script: Script::AluVM(AluScript {
</span><span>            libs: confined_bmap! { alu_id =&gt; alu_lib },
</span><span>            entry_points: confined_bmap! {
</span><span>                EntryPoint::ValidateOwnedState(</span><span style="color:#d08770;">OS_ASSETS</span><span>) =&gt; LibSite::with(</span><span style="color:#d08770;">0</span><span>, alu_id)
</span><span>            },
</span><span>        }),
</span><span>    }
</span><span>}
</span></code></pre>

            </div>
        </section>
    
        
            
        
        
            
            
        
        <section class="section-white ">
            <div>
                <header  id="interface"  class="pb0">
                    <h2>Doing custom interface</h2>
                    <div class="highlight"></div>
                </header>

                <pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">rgb20</span><span>() -&gt; Iface {
</span><span>    </span><span style="color:#b48ead;">let</span><span> types = StandardTypes::new();
</span><span>
</span><span>    Iface {
</span><span>        name: tn!(&quot;</span><span style="color:#a3be8c;">RGB20</span><span>&quot;),
</span><span>        global_state: tiny_bmap! {
</span><span>            tn!(&quot;</span><span style="color:#a3be8c;">Nominal</span><span>&quot;) =&gt; Req::require(types.</span><span style="color:#96b5b4;">get</span><span>(&quot;</span><span style="color:#a3be8c;">RGBContract.Nominal</span><span>&quot;)),
</span><span>            tn!(&quot;</span><span style="color:#a3be8c;">ContractText</span><span>&quot;) =&gt; Req::require(types.</span><span style="color:#96b5b4;">get</span><span>(&quot;</span><span style="color:#a3be8c;">RGBContract.ContractText</span><span>&quot;)),
</span><span>        },
</span><span>        assignments: tiny_bmap! {
</span><span>            tn!(&quot;</span><span style="color:#a3be8c;">Assets</span><span>&quot;) =&gt; AssignIface::private(OwnedIface::Amount),
</span><span>        },
</span><span>        valencies: none!(),
</span><span>        genesis: GenesisIface {
</span><span>            metadata: None,
</span><span>            global: tiny_bmap! {
</span><span>                tn!(&quot;</span><span style="color:#a3be8c;">Nominal</span><span>&quot;) =&gt; Occurrences::Once,
</span><span>                tn!(&quot;</span><span style="color:#a3be8c;">ContractText</span><span>&quot;) =&gt; Occurrences::Once,
</span><span>            },
</span><span>            assignments: tiny_bmap! {
</span><span>                tn!(&quot;</span><span style="color:#a3be8c;">Assets</span><span>&quot;) =&gt; Occurrences::OnceOrMore
</span><span>            },
</span><span>            valencies: none!(),
</span><span>        },
</span><span>        transitions: tiny_bmap! {
</span><span>            tn!(&quot;</span><span style="color:#a3be8c;">Transfer</span><span>&quot;) =&gt; TransitionIface {
</span><span>                metadata: None,
</span><span>                globals: none!(),
</span><span>                inputs: tiny_bmap! {
</span><span>                    tn!(&quot;</span><span style="color:#a3be8c;">Assets</span><span>&quot;) =&gt; Occurrences::OnceOrMore,
</span><span>                },
</span><span>                assignments: tiny_bmap! {
</span><span>                    tn!(&quot;</span><span style="color:#a3be8c;">Assets</span><span>&quot;) =&gt; Occurrences::OnceOrMore,
</span><span>                },
</span><span>                valencies: none!(),
</span><span>                default_assignment: Some(tn!(&quot;</span><span style="color:#a3be8c;">Assets</span><span>&quot;)),
</span><span>            }
</span><span>        },
</span><span>        extensions: none!(),
</span><span>        default_operation: Some(tn!(&quot;</span><span style="color:#a3be8c;">Transfer</span><span>&quot;)),
</span><span>    }
</span><span>}
</span></code></pre>

            </div>
        </section>
    
        
            
        
        
            
            
        
        <section class="section-red ">
            <div>
                <header  id="iimpl"  class="pb0">
                    <h2>Implementing interface</h2>
                    <div class="highlight"></div>
                </header>

                <pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">iface_impl</span><span>() -&gt; IfaceImpl {
</span><span>    </span><span style="color:#b48ead;">let</span><span> schema = </span><span style="color:#96b5b4;">schema</span><span>();
</span><span>    </span><span style="color:#b48ead;">let</span><span> iface = </span><span style="color:#96b5b4;">rgb20</span><span>();
</span><span>
</span><span>    IfaceImpl {
</span><span>        schema_id: schema.</span><span style="color:#96b5b4;">schema_id</span><span>(),
</span><span>        iface_id: iface.</span><span style="color:#96b5b4;">iface_id</span><span>(),
</span><span>        global_state: tiny_bset! {
</span><span>            NamedType::with(</span><span style="color:#d08770;">GS_NOMINAL</span><span>, tn!(&quot;</span><span style="color:#a3be8c;">Nominal</span><span>&quot;)),
</span><span>            NamedType::with(</span><span style="color:#d08770;">GS_CONTRACT</span><span>, tn!(&quot;</span><span style="color:#a3be8c;">ContractText</span><span>&quot;)),
</span><span>        },
</span><span>        assignments: tiny_bset! {
</span><span>            NamedType::with(</span><span style="color:#d08770;">OS_ASSETS</span><span>, tn!(&quot;</span><span style="color:#a3be8c;">Assets</span><span>&quot;)),
</span><span>        },
</span><span>        valencies: none!(),
</span><span>        transitions: tiny_bset! {
</span><span>            NamedType::with(</span><span style="color:#d08770;">TS_TRANSFER</span><span>, tn!(&quot;</span><span style="color:#a3be8c;">Transfer</span><span>&quot;)),
</span><span>        },
</span><span>        extensions: none!(),
</span><span>    }
</span><span>}
</span></code></pre>

            </div>
        </section>
    
</main>

<footer><div class="w-100 mw-none ph3 mw8-m mw9-l center f3">
  <div class="flex flex-column flex-row-ns pv0-l">
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Get help!</h4>
      <ul>
        <li><a href="http://rgbfaq.com">RGB FAQ</a></li>
        <li><a href="https://blackpaper.rgb.tech">White paper</a></li>
        <li><a href="/docs">Documentation</a></li>
        <li><a href="https://standards.lnp-bp.org">Standards</a></li>
      </ul>
    </div>
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Terms and policies</h4>
      <ul>
        <li><a href="/policies/licenses">Licenses</a></li>
        <li><a href="/policies/logo-policy-and-media-guide/">Logo Policy and Media Guide</a></li>
        <li><a href="/policies/security">Security Disclosures</a></li>
        <li><a href="/policies/privacy-policy/">Privacy Notice</a></li>
      </ul>
    </div>
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Social</h4>
      <div class="flex flex-row flex-wrap">
        <a href="https://twitter.com/lnp_bp"><img src="/social/twitter.svg" alt="twitter logo" title="Twitter"></a>
        <a href="https://www.youtube.com/LNP-BP"><img class="pv2" src="/social/youtube.svg" alt="youtube logo" title="YouTube"></a>
        <a href="https://reddit.com/r/RGB_protocol"><img src="/social/reddit.svg" alt="discord logo" title="Discord"></a>
        <a href="https://github.com/RGB-WG"><img src="/social/github.svg" alt="github logo" title="GitHub"></a>
      </div>
    </div>

  </div>
  <div class="attribution">
    <p>
      Maintained by the <a href="https://www.lnp-bp.org">LNP/BP Standards Association</a>. See a bug?
      <a href="https://github.com/RGB-WG/rgb.tech/issues/new">File an issue!</a>
    </p>
    <p>Uses layout &amp; styles from <a href="https://github.com/rust-lang/www.rust-lang.org" target="_blank">Rust Language website</a></p>
  </div>
</div>

</footer>
</body>

</html>
